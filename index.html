<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Room Booking - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #f8bbd9 50%, #e1f5fe 100%);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #00bcd4 0%, #e91e63 100%);
        }
        
        .day-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .day-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 188, 212, 0.15);
        }
        
        .day-selected {
            border-color: #e91e63;
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
        }
        
        .booking-item {
            background: linear-gradient(135deg, #e1f5fe 0%, #f3e5f5 100%);
            border-left: 4px solid #00bcd4;
        }
        
        .room-available {
            background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%);
            border-color: #4caf50;
        }
        
        .room-booked {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            border-color: #f44336;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-center">üè´ Smart Room Booking</h1>
            <p class="text-center text-lg mt-2 opacity-90">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</p>
            <div class="text-center mt-3">
                <span id="connectionStatus" class="text-yellow-200 text-sm font-medium">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-4">
            <div class="flex justify-center space-x-1 py-3">
                <button onclick="showPage('booking')" class="nav-btn px-6 py-2 rounded-lg font-medium transition-all duration-200 bg-blue-500 text-white">
                    üìÖ ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                </button>
                <button onclick="showPage('myBookings')" class="nav-btn px-6 py-2 rounded-lg font-medium transition-all duration-200 text-blue-600 hover:bg-blue-50">
                    üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                </button>
                <button onclick="showPage('allBookings')" class="nav-btn px-6 py-2 rounded-lg font-medium transition-all duration-200 text-blue-600 hover:bg-blue-50">
                    üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button onclick="showPage('statistics')" class="nav-btn px-6 py-2 rounded-lg font-medium transition-all duration-200 text-blue-600 hover:bg-blue-50">
                    üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                </button>
                <button onclick="showPage('settings')" class="nav-btn px-6 py-2 rounded-lg font-medium transition-all duration-200 text-blue-600 hover:bg-blue-50">
                    ‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
                <button onclick="refreshData()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm">
                    üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- Booking Page -->
        <div id="bookingPage" class="page">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Weekly Schedule -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                            üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô (‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå - ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå)
                        </h3>
                        <div class="space-y-3" id="weeklySchedule">
                            <!-- Weekly days will be populated here -->
                        </div>
                        
                        <!-- Time Selection -->
                        <div class="mt-6">
                            <h4 class="font-semibold text-gray-800 mb-3">‚è∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
                                    <select id="startTime" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <!-- Time options will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                                    <select id="endTime" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <!-- Time options will be populated by JavaScript -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Room Selection -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                            üè´ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                        </h3>
                        
                        <!-- Room Dropdown -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                            <select id="roomSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
                            </select>
                        </div>
                        
                        <!-- Room Details -->
                        <div id="roomDetails" class="hidden">
                            <div class="border-2 rounded-lg p-4 mb-4" id="roomCard">
                                <div class="flex justify-between items-start mb-3">
                                    <h4 class="font-semibold text-lg text-gray-800" id="roomName"></h4>
                                    <span class="text-sm" id="roomStatus"></span>
                                </div>
                                <p class="text-gray-600 text-sm mb-2" id="roomCapacity"></p>
                                <p class="text-gray-600 text-sm mb-3" id="roomChairType"></p>
                                <button id="bookButton" onclick="openBookingModal()" class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
                                    ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ
                                </button>
                            </div>
                        </div>
                        
                        <!-- Selected Day Bookings -->
                        <div id="dayBookings" class="mt-6">
                            <h4 class="font-semibold text-gray-800 mb-3">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h4>
                            <div id="dayBookingsList" class="space-y-2">
                                <p class="text-gray-500 text-center py-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Bookings Page -->
        <div id="myBookingsPage" class="page hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                    üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                </h3>
                
                <!-- Filters -->
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</label>
                        <select id="roomFilter" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="dateFilter" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex items-end">
                        <button onclick="applyFilters()" class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </div>
                </div>
                
                <div id="myBookingsList" class="space-y-4">
                    <!-- My bookings will be populated here -->
                </div>
            </div>
        </div>

        <!-- All Bookings Schedule Page -->
        <div id="allBookingsPage" class="page hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                    üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </h3>
                
                <!-- Room Filter -->
                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π</label>
                        <select id="scheduleRoomFilter" onchange="updateScheduleView()" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</label>
                        <select id="viewMode" onchange="updateScheduleView()" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="time-horizontal">‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô (‡∏ß‡∏±‡∏ô ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á)</option>
                            <option value="day-horizontal">‡∏ß‡∏±‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô (‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Schedule Summary -->
                <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-pink-50 rounded-lg">
                    <h4 class="font-semibold text-gray-800 mb-2">üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h4>
                    <div class="grid grid-cols-7 gap-2 text-center" id="weekSummary">
                        <!-- Week summary will be populated here -->
                    </div>
                </div>
                
                <!-- Weekly Schedule View -->
                <div class="overflow-x-auto">
                    <div id="scheduleContainer">
                        <!-- Schedule table will be populated here -->
                    </div>
                </div>
                
                <!-- Legend -->
                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <h4 class="font-semibold text-gray-800 mb-3">üé® ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏µ</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 bg-blue-100 border border-blue-300 rounded"></div>
                            <span>‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 bg-green-100 border border-green-300 rounded"></div>
                            <span>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 bg-purple-100 border border-purple-300 rounded"></div>
                            <span>‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 bg-pink-100 border border-pink-300 rounded"></div>
                            <span>‡∏´‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="page hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                    ‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
                </h3>
                
                <!-- Google Sheets Configuration -->
                <div class="mb-8">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">üîó ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h4>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <h5 class="font-semibold text-blue-800 mb-2">üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets:</h5>
                        <ol class="list-decimal list-inside text-sm text-blue-700 space-y-1">
                            <li>‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheet ‡πÉ‡∏´‡∏°‡πà</li>
                            <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà Extensions ‚Üí Apps Script</li>
                            <li>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î Google Apps Script ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</li>
                            <li>Deploy ‡πÄ‡∏õ‡πá‡∏ô Web App ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL</li>
                            <li>‡∏ô‡∏≥ URL ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</li>
                        </ol>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Google Apps Script Web App URL</label>
                            <input type="url" id="webAppUrl" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec" 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="testConnection()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                            </button>
                            <button onclick="saveSettings()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Google Apps Script Code -->
                <div class="mb-8">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">üìù Google Apps Script Code</h4>
                    <div class="bg-gray-100 border rounded-lg p-4">
                        <pre class="text-sm text-gray-800 whitespace-pre-wrap" id="gasCode">function doGet(e) {
  const action = e.parameter.action;
  
  if (action === 'getBookings') {
    return getBookings();
  }
  
  return ContentService.createTextOutput(JSON.stringify({success: false, message: 'Invalid action'}))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const action = data.action;
    
    if (action === 'addBooking') {
      return addBooking(data.data);
    } else if (action === 'updateBooking') {
      return updateBooking(data.bookingId, data.data);
    }
    
    return ContentService.createTextOutput(JSON.stringify({success: false, message: 'Invalid action'}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({success: false, message: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function getBookings() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const data = sheet.getDataRange().getValues();
  
  if (data.length <= 1) {
    return ContentService.createTextOutput(JSON.stringify({success: true, data: []}))
      .setMimeType(ContentService.MimeType.JSON);
  }
  
  const bookings = [];
  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    bookings.push({
      id: row[0],
      roomId: row[1],
      roomName: row[2],
      day: row[3],
      startTime: row[4],
      endTime: row[5],
      subject: row[6],
      status: row[7],
      createdAt: row[8]
    });
  }
  
  return ContentService.createTextOutput(JSON.stringify({success: true, data: bookings}))
    .setMimeType(ContentService.MimeType.JSON);
}

function addBooking(booking) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  
  // Add header if sheet is empty
  if (sheet.getLastRow() === 0) {
    sheet.appendRow(['ID', 'Room ID', 'Room Name', 'Day', 'Start Time', 'End Time', 'Subject', 'Status', 'Created At']);
  }
  
  sheet.appendRow([
    booking.id,
    booking.roomId,
    booking.roomName,
    booking.day,
    booking.startTime,
    booking.endTime,
    booking.subject,
    booking.status,
    booking.createdAt
  ]);
  
  return ContentService.createTextOutput(JSON.stringify({success: true}))
    .setMimeType(ContentService.MimeType.JSON);
}

function updateBooking(bookingId, updates) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const data = sheet.getDataRange().getValues();
  
  for (let i = 1; i < data.length; i++) {
    if (data[i][0] == bookingId) {
      if (updates.status) {
        sheet.getRange(i + 1, 8).setValue(updates.status);
      }
      break;
    }
  }
  
  return ContentService.createTextOutput(JSON.stringify({success: true}))
    .setMimeType(ContentService.MimeType.JSON);
}</pre>
                        <button onclick="copyGASCode()" class="mt-3 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm">
                            üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î
                        </button>
                    </div>
                </div>
                
                <!-- Data Management -->
                <div class="mb-8">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">üíæ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <button onclick="exportData()" class="p-4 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 transition-colors">
                            üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (JSON)
                        </button>
                        <button onclick="clearAllData()" class="p-4 bg-red-100 text-red-800 rounded-lg hover:bg-red-200 transition-colors">
                            üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Page -->
        <div id="statisticsPage" class="page hidden">
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </h4>
                    <div class="text-3xl font-bold text-blue-600" id="totalBookings">0</div>
                    <p class="text-gray-600 mt-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        üèÜ ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                    </h4>
                    <div class="text-lg font-semibold text-pink-600" id="mostUsedRoom">-</div>
                    <p class="text-gray-600 mt-2" id="mostUsedRoomCount">0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        ‚è∞ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                    </h4>
                    <div class="text-lg font-semibold text-blue-600" id="peakTime">-</div>
                    <p class="text-gray-600 mt-2" id="peakTimeCount">0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                </div>
                
                <div class="md:col-span-2 lg:col-span-3 bg-white rounded-xl shadow-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á</h4>
                    <div id="roomStats" class="space-y-3">
                        <!-- Room statistics will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl p-8 m-4 max-w-md w-full">
            <h3 class="text-xl font-semibold text-gray-800 mb-6">üìù ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h3>
            
            <form id="bookingForm" onsubmit="submitBooking(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <input type="text" id="selectedRoom" readonly class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="text" id="selectedDate" readonly class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <input type="text" id="selectedTime" readonly class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏¥‡∏ä‡∏≤ *</label>
                        <input type="text" id="subject" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤">
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-6">
                    <button type="button" onclick="closeBookingModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cancel Booking Modal -->
    <div id="cancelModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl p-8 m-4 max-w-md w-full">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h3>
            <p class="text-gray-600 mb-4">‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</p>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</label>
                <input type="password" id="cancelCode" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                <p id="cancelError" class="text-red-500 text-sm mt-1 hidden">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
            </div>
            
            <div class="flex space-x-3">
                <button onclick="closeCancelModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                    ‡∏õ‡∏¥‡∏î
                </button>
                <button onclick="confirmCancel()" class="flex-1 px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let selectedDays = [];
        let selectedRoom = null;
        let bookings = [];
        let currentBookingToCancel = null;
        let isOnlineMode = false;
        
        // Google Sheets Configuration
        const GOOGLE_SHEETS_CONFIG = {
            // ‡πÉ‡∏™‡πà Google Apps Script Web App URL ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            WEB_APP_URL: 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec',
            // ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Google Sheets API (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ API Key)
            SHEET_ID: 'YOUR_GOOGLE_SHEET_ID',
            API_KEY: 'YOUR_API_KEY'
        };
        
        // Online Database Functions
        async function saveToOnlineDatabase(booking) {
            try {
                const response = await fetch(GOOGLE_SHEETS_CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addBooking',
                        data: booking
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const result = await response.json();
                return result.success;
            } catch (error) {
                console.error('Error saving to online database:', error);
                // Fallback to localStorage
                saveToLocalStorage();
                return false;
            }
        }
        
        async function loadFromOnlineDatabase() {
            try {
                const response = await fetch(GOOGLE_SHEETS_CONFIG.WEB_APP_URL + '?action=getBookings', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const result = await response.json();
                if (result.success && result.data) {
                    bookings = result.data;
                    isOnlineMode = true;
                    updateConnectionStatus(true);
                    return true;
                }
            } catch (error) {
                console.error('Error loading from online database:', error);
                // Fallback to localStorage
                loadFromLocalStorage();
                updateConnectionStatus(false);
                return false;
            }
        }
        
        async function updateOnlineDatabase(bookingId, updates) {
            try {
                const response = await fetch(GOOGLE_SHEETS_CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateBooking',
                        bookingId: bookingId,
                        data: updates
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const result = await response.json();
                return result.success;
            } catch (error) {
                console.error('Error updating online database:', error);
                return false;
            }
        }
        
        // Local Storage Functions (Fallback)
        function saveToLocalStorage() {
            localStorage.setItem('classroomBookings', JSON.stringify(bookings));
        }
        
        function loadFromLocalStorage() {
            const stored = localStorage.getItem('classroomBookings');
            if (stored) {
                bookings = JSON.parse(stored);
            }
            isOnlineMode = false;
        }
        
        // Connection Status
        function updateConnectionStatus(online) {
            const statusElement = document.getElementById('connectionStatus');
            if (online) {
                statusElement.innerHTML = 'üü¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß';
                statusElement.className = 'text-green-600 text-sm font-medium';
            } else {
                statusElement.innerHTML = 'üî¥ ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á';
                statusElement.className = 'text-red-600 text-sm font-medium';
            }
        }
        
        // Auto-sync function
        async function autoSync() {
            if (isOnlineMode) {
                await loadFromOnlineDatabase();
                updateAllViews();
            }
        }
        
        // Set up auto-sync every 30 seconds
        setInterval(autoSync, 30000);
        
        // Settings Functions
        function saveSettings() {
            const webAppUrl = document.getElementById('webAppUrl').value;
            
            if (!webAppUrl) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App');
                return;
            }
            
            GOOGLE_SHEETS_CONFIG.WEB_APP_URL = webAppUrl;
            localStorage.setItem('googleSheetsConfig', JSON.stringify(GOOGLE_SHEETS_CONFIG));
            
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        function loadSettings() {
            const saved = localStorage.getItem('googleSheetsConfig');
            if (saved) {
                const config = JSON.parse(saved);
                Object.assign(GOOGLE_SHEETS_CONFIG, config);
                
                if (document.getElementById('webAppUrl')) {
                    document.getElementById('webAppUrl').value = config.WEB_APP_URL || '';
                }
            }
        }
        
        async function testConnection() {
            const webAppUrl = document.getElementById('webAppUrl').value;
            
            if (!webAppUrl) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
                return;
            }
            
            try {
                const response = await fetch(webAppUrl + '?action=getBookings', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success !== undefined) {
                        alert('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ' + (result.data ? result.data.length : 0) + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                    } else {
                        alert('‚ö†Ô∏è ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    }
                } else {
                    alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ (HTTP ' + response.status + ')');
                }
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ' + error.message);
            }
        }
        
        function copyGASCode() {
            const code = document.getElementById('gasCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            }).catch(() => {
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á');
            });
        }
        
        function exportData() {
            const dataStr = JSON.stringify(bookings, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'classroom-bookings-' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            
            URL.revokeObjectURL(url);
        }
        
        function clearAllData() {
            if (confirm('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
                if (confirm('üö® ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á: ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠?')) {
                    bookings = [];
                    localStorage.removeItem('classroomBookings');
                    updateAllViews();
                    alert('‚úÖ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
            }
        }
        
        async function refreshData() {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä...';
            button.disabled = true;
            
            try {
                const success = await loadFromOnlineDatabase();
                if (success) {
                    updateAllViews();
                    alert('‚úÖ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                } else {
                    alert('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á');
                }
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä');
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        // Room data
        const rooms = [
            { id: 'kitchen', name: '‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ß', capacity: 30, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' },
            { id: 'aviation', name: '‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: 'hotel', name: '‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°', capacity: 35, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' },
            { id: '1-305', name: '1-305 (‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏£‡∏°‡πÅ‡∏î‡∏á)', capacity: 80, chairType: '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ' },
            { id: '1-405', name: '1-405 (‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏≠‡∏™‡∏ï‡∏π‡∏°)', capacity: 40, chairType: '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ' },
            { id: '3-401', name: '3-401 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏ß‡∏ó‡∏µ‡∏î‡∏≥)', capacity: 40, chairType: '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ' },
            { id: '4-101', name: '4-101 (‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏ï‡∏π‡∏î‡∏¥‡πÇ‡∏≠)', capacity: 40, chairType: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ' },
            { id: '2-101', name: '2-101 (‡∏´‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á/‡∏´‡πâ‡∏≠‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏î‡∏≥)', capacity: 80, chairType: '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ' },
            { id: '2-105', name: '2-105 (‡∏´‡πâ‡∏≠‡∏á Broadway)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÑ‡∏°‡πâ/‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '1-201', name: '1-201 (‡∏´‡πâ‡∏≠‡∏á Mac)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '1-205', name: '1-205 (‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '1-301', name: '1-301 (‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå)', capacity: 50, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '1-306', name: '1-306 (‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '1-401', name: '1-401 (‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '1-406', name: '1-406 (‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå)', capacity: 50, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '1-302', name: '1-302', capacity: 50, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '1-304', name: '1-304', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '1-402', name: '1-402', capacity: 50, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '1-403', name: '1-403', capacity: 50, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '1-404', name: '1-404', capacity: 50, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '1-405-lecture', name: '1-405', capacity: 50, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '2-103', name: '2-103 (‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå‡∏Ø)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '2-301', name: '2-301', capacity: 80, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '2-302', name: '2-302', capacity: 60, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '2-303', name: '2-303', capacity: 60, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '2-304', name: '2-304', capacity: 60, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '2-305', name: '2-305', capacity: 60, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå‡∏Ñ‡∏π‡πà' },
            { id: '2-306', name: '2-306', capacity: 60, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå‡∏Ñ‡∏π‡πà' },
            { id: '2-307', name: '2-307', capacity: 60, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå‡∏Ñ‡∏π‡πà' },
            { id: '2-401', name: '2-401', capacity: 80, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '2-402', name: '2-402 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '2-403', name: '2-403 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '2-404', name: '2-404 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '2-405', name: '2-405 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '2-406', name: '2-406 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '2-407', name: '2-407 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '3-402', name: '3-402 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡πÇ‡∏ó/‡∏õ.‡πÄ‡∏≠‡∏Å)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '3-403', name: '3-403 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡πÇ‡∏ó/‡∏õ.‡πÄ‡∏≠‡∏Å)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '3-404', name: '3-404 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡πÇ‡∏ó/‡∏õ.‡πÄ‡∏≠‡∏Å)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '3-406', name: '3-406', capacity: 120, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå‡∏Ñ‡∏π‡πà' },
            { id: '3-407', name: '3-407', capacity: 120, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå‡∏Ñ‡∏π‡πà' },
            { id: '4-304', name: '4-304 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡πÇ‡∏ó/‡∏õ.‡πÄ‡∏≠‡∏Å)', capacity: 60, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '4-305', name: '4-305 (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.‡πÇ‡∏ó/‡∏õ.‡πÄ‡∏≠‡∏Å)', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '4-306', name: '4-306', capacity: 40, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô' },
            { id: '4-401', name: '4-401', capacity: 120, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '4-402', name: '4-402', capacity: 120, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' },
            { id: '4-403', name: '4-403', capacity: 120, chairType: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏•‡∏Ñ‡πÄ‡∏ä‡∏≠‡∏£‡πå' }
        ];

        // Days of the week
        const daysOfWeek = [
            { id: 'monday', name: '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', shortName: '‡∏à' },
            { id: 'tuesday', name: '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', shortName: '‡∏≠' },
            { id: 'wednesday', name: '‡∏û‡∏∏‡∏ò', shortName: '‡∏û' },
            { id: 'thursday', name: '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', shortName: '‡∏û‡∏§' },
            { id: 'friday', name: '‡∏®‡∏∏‡∏Å‡∏£‡πå', shortName: '‡∏®' },
            { id: 'saturday', name: '‡πÄ‡∏™‡∏≤‡∏£‡πå', shortName: '‡∏™' },
            { id: 'sunday', name: '‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', shortName: '‡∏≠‡∏≤' }
        ];

        // Initialize the application
        async function init() {
            // Load settings first
            loadSettings();
            
            generateTimeOptions();
            generateWeeklySchedule();
            populateRoomDropdown();
            populateRoomFilters();
            
            // Try to load from online database first
            const onlineSuccess = await loadFromOnlineDatabase();
            if (!onlineSuccess) {
                // Fallback to local storage
                loadFromLocalStorage();
            }
            
            updateAllViews();
            
            // Set default time
            document.getElementById('startTime').value = '09:00';
            document.getElementById('endTime').value = '10:00';
        }
        
        // Update all views
        function updateAllViews() {
            updateMyBookings();
            updateStatistics();
            updateScheduleView();
            updateRoomStatus();
            updateDayBookings();
        }

        // Generate time options
        function generateTimeOptions() {
            const startSelect = document.getElementById('startTime');
            const endSelect = document.getElementById('endTime');
            
            startSelect.innerHTML = '';
            endSelect.innerHTML = '';
            
            // Generate start time options (9:00 - 20:00, every hour)
            for (let hour = 9; hour <= 20; hour++) {
                const timeString = `${hour.toString().padStart(2, '0')}:00`;
                startSelect.innerHTML += `<option value="${timeString}">${timeString}</option>`;
            }
            
            // Generate end time options (9:00 - 20:30, with 00, 30, 40 minutes)
            for (let hour = 9; hour <= 20; hour++) {
                for (let minute of [0, 30, 40]) {
                    if (hour === 20 && minute > 30) continue;
                    
                    const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    endSelect.innerHTML += `<option value="${timeString}">${timeString}</option>`;
                }
            }
        }

        // Generate weekly schedule
        function generateWeeklySchedule() {
            const weeklySchedule = document.getElementById('weeklySchedule');
            
            weeklySchedule.innerHTML = daysOfWeek.map(day => `
                <div class="day-card p-3 rounded-lg cursor-pointer border-2" onclick="toggleDaySelection('${day.id}')">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">${day.name}</span>
                        <span class="text-sm text-gray-500">${day.shortName}</span>
                    </div>
                </div>
            `).join('');
        }

        // Toggle day selection
        function toggleDaySelection(dayId) {
            const dayElement = event.currentTarget;
            const dayIndex = selectedDays.indexOf(dayId);
            
            if (dayIndex > -1) {
                selectedDays.splice(dayIndex, 1);
                dayElement.classList.remove('day-selected');
            } else {
                selectedDays.push(dayId);
                dayElement.classList.add('day-selected');
            }
            
            updateRoomStatus();
            updateDayBookings();
        }

        // Populate room dropdown
        function populateRoomDropdown() {
            const roomSelect = document.getElementById('roomSelect');
            
            rooms.forEach(room => {
                roomSelect.innerHTML += `<option value="${room.id}">${room.name}</option>`;
            });
            
            roomSelect.addEventListener('change', function() {
                if (this.value) {
                    selectedRoom = rooms.find(r => r.id === this.value);
                    showRoomDetails();
                } else {
                    selectedRoom = null;
                    hideRoomDetails();
                }
            });
        }

        // Show room details
        function showRoomDetails() {
            if (!selectedRoom) return;
            
            const roomDetails = document.getElementById('roomDetails');
            const roomCard = document.getElementById('roomCard');
            const roomName = document.getElementById('roomName');
            const roomCapacity = document.getElementById('roomCapacity');
            const roomChairType = document.getElementById('roomChairType');
            const roomStatus = document.getElementById('roomStatus');
            const bookButton = document.getElementById('bookButton');
            
            roomName.textContent = selectedRoom.name;
            roomCapacity.textContent = `üë• ‡∏à‡∏∏‡πÑ‡∏î‡πâ ${selectedRoom.capacity} ‡∏Ñ‡∏ô`;
            roomChairType.textContent = `ü™ë ${selectedRoom.chairType}`;
            
            // Check availability
            const isAvailable = checkRoomAvailability();
            
            if (isAvailable) {
                roomCard.className = 'border-2 rounded-lg p-4 mb-4 room-available';
                roomStatus.innerHTML = '<span class="text-green-600">‚úÖ ‡∏ß‡πà‡∏≤‡∏á</span>';
                bookButton.disabled = false;
                bookButton.textContent = '‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ';
            } else {
                roomCard.className = 'border-2 rounded-lg p-4 mb-4 room-booked';
                roomStatus.innerHTML = '<span class="text-red-600">‚ùå ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>';
                bookButton.disabled = true;
                bookButton.textContent = '‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á';
            }
            
            roomDetails.classList.remove('hidden');
        }

        // Hide room details
        function hideRoomDetails() {
            document.getElementById('roomDetails').classList.add('hidden');
        }

        // Check room availability
        function checkRoomAvailability() {
            if (!selectedRoom || selectedDays.length === 0) return true;
            
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            if (!startTime || !endTime) return true;
            
            for (const day of selectedDays) {
                const conflict = bookings.some(booking => 
                    booking.roomId === selectedRoom.id && 
                    booking.day === day &&
                    booking.status === 'confirmed' &&
                    timeOverlap(startTime, endTime, booking.startTime, booking.endTime)
                );
                
                if (conflict) return false;
            }
            
            return true;
        }

        // Update room status
        function updateRoomStatus() {
            if (selectedRoom) {
                showRoomDetails();
            }
        }

        // Update day bookings display
        function updateDayBookings() {
            const dayBookingsList = document.getElementById('dayBookingsList');
            
            if (selectedDays.length === 0) {
                dayBookingsList.innerHTML = '<p class="text-gray-500 text-center py-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>';
                return;
            }
            
            const dayBookings = bookings.filter(booking => 
                selectedDays.includes(booking.day) && booking.status === 'confirmed'
            );
            
            if (dayBookings.length === 0) {
                dayBookingsList.innerHTML = '<p class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>';
                return;
            }
            
            dayBookingsList.innerHTML = dayBookings.map(booking => {
                const room = rooms.find(r => r.id === booking.roomId);
                const dayName = daysOfWeek.find(d => d.id === booking.day)?.name || booking.day;
                
                return `
                    <div class="booking-item p-3 rounded-lg">
                        <div class="flex justify-between items-start">
                            <div>
                                <h5 class="font-medium text-gray-800">${room?.name || booking.roomId}</h5>
                                <p class="text-sm text-gray-600">üìÖ ${dayName}</p>
                                <p class="text-sm text-gray-600">‚è∞ ${booking.startTime} - ${booking.endTime}</p>
                                <p class="text-sm text-gray-600">üìö ${booking.subject}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Check time overlap
        function timeOverlap(start1, end1, start2, end2) {
            return start1 < end2 && end1 > start2;
        }

        // Open booking modal
        function openBookingModal() {
            if (!selectedRoom || selectedDays.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á');
                return;
            }
            
            document.getElementById('selectedRoom').value = selectedRoom.name;
            document.getElementById('selectedDate').value = selectedDays.map(day => 
                daysOfWeek.find(d => d.id === day)?.name).join(', ');
            document.getElementById('selectedTime').value = 
                `${document.getElementById('startTime').value} - ${document.getElementById('endTime').value}`;
            
            document.getElementById('bookingModal').classList.remove('hidden');
            document.getElementById('bookingModal').classList.add('flex');
        }

        // Close booking modal
        function closeBookingModal() {
            document.getElementById('bookingModal').classList.add('hidden');
            document.getElementById('bookingModal').classList.remove('flex');
            document.getElementById('bookingForm').reset();
        }

        // Submit booking
        async function submitBooking(event) {
            event.preventDefault();
            
            const subject = document.getElementById('subject').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            // Show loading
            const submitButton = event.target.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            submitButton.disabled = true;
            
            try {
                // Create bookings for all selected days
                const newBookings = [];
                for (const day of selectedDays) {
                    const booking = {
                        id: Date.now() + Math.random(),
                        roomId: selectedRoom.id,
                        roomName: selectedRoom.name,
                        day: day,
                        startTime: startTime,
                        endTime: endTime,
                        subject: subject,
                        status: 'confirmed',
                        createdAt: new Date().toISOString()
                    };
                    
                    newBookings.push(booking);
                    bookings.push(booking);
                }
                
                // Try to save online first
                let saveSuccess = false;
                if (isOnlineMode) {
                    for (const booking of newBookings) {
                        const success = await saveToOnlineDatabase(booking);
                        if (success) {
                            saveSuccess = true;
                        }
                    }
                }
                
                // Always save to localStorage as backup
                saveToLocalStorage();
                
                closeBookingModal();
                updateAllViews();
                
                if (saveSuccess || !isOnlineMode) {
                    alert('‚úÖ ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
                } else {
                    alert('‚ö†Ô∏è ‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå');
                }
                
            } catch (error) {
                console.error('Error submitting booking:', error);
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
            } finally {
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        }

        // Show page
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show selected page
            document.getElementById(pageId + 'Page').classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.className = 'nav-btn px-6 py-2 rounded-lg font-medium transition-all duration-200 text-blue-600 hover:bg-blue-50';
            });
            
            event.target.className = 'nav-btn px-6 py-2 rounded-lg font-medium transition-all duration-200 bg-blue-500 text-white';
            
            // Update page-specific content
            if (pageId === 'myBookings') {
                updateMyBookings();
            } else if (pageId === 'statistics') {
                updateStatistics();
            } else if (pageId === 'allBookings') {
                updateScheduleView();
            }
        }

        // Update my bookings
        function updateMyBookings() {
            const myBookingsList = document.getElementById('myBookingsList');
            const userBookings = bookings.filter(booking => booking.status === 'confirmed');
            
            if (userBookings.length === 0) {
                myBookingsList.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>';
                return;
            }
            
            myBookingsList.innerHTML = userBookings.map(booking => {
                const dayName = daysOfWeek.find(d => d.id === booking.day)?.name || booking.day;
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-semibold text-lg text-gray-800">${booking.roomName}</h4>
                                <p class="text-gray-600 mt-1">üìÖ ${dayName}</p>
                                <p class="text-gray-600">‚è∞ ${booking.startTime} - ${booking.endTime}</p>
                                <p class="text-gray-600">üìö ${booking.subject}</p>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                                    ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                                </span>
                                <button onclick="openCancelModal('${booking.id}')" 
                                        class="px-3 py-1 bg-red-100 text-red-600 rounded-lg text-sm hover:bg-red-200 transition-colors">
                                    ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Populate room filters
        function populateRoomFilters() {
            const roomFilter = document.getElementById('roomFilter');
            const scheduleRoomFilter = document.getElementById('scheduleRoomFilter');
            
            rooms.forEach(room => {
                const option = `<option value="${room.id}">${room.name}</option>`;
                roomFilter.innerHTML += option;
                scheduleRoomFilter.innerHTML += option;
            });
        }

        // Apply filters
        function applyFilters() {
            const roomFilter = document.getElementById('roomFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            let filteredBookings = bookings.filter(booking => booking.status === 'confirmed');
            
            if (roomFilter) {
                filteredBookings = filteredBookings.filter(booking => booking.roomId === roomFilter);
            }
            
            // Note: dateFilter is not directly applicable since we use days of week
            // You could extend this to filter by specific dates if needed
            
            const myBookingsList = document.getElementById('myBookingsList');
            
            if (filteredBookings.length === 0) {
                myBookingsList.innerHTML = '<p class="text-gray-500 text-center py-8">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</p>';
                return;
            }
            
            myBookingsList.innerHTML = filteredBookings.map(booking => {
                const dayName = daysOfWeek.find(d => d.id === booking.day)?.name || booking.day;
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-semibold text-lg text-gray-800">${booking.roomName}</h4>
                                <p class="text-gray-600 mt-1">üìÖ ${dayName}</p>
                                <p class="text-gray-600">‚è∞ ${booking.startTime} - ${booking.endTime}</p>
                                <p class="text-gray-600">üìö ${booking.subject}</p>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                                    ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                                </span>
                                <button onclick="openCancelModal('${booking.id}')" 
                                        class="px-3 py-1 bg-red-100 text-red-600 rounded-lg text-sm hover:bg-red-200 transition-colors">
                                    ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Open cancel modal
        function openCancelModal(bookingId) {
            currentBookingToCancel = bookingId;
            document.getElementById('cancelModal').classList.remove('hidden');
            document.getElementById('cancelModal').classList.add('flex');
        }

        // Close cancel modal
        function closeCancelModal() {
            document.getElementById('cancelModal').classList.add('hidden');
            document.getElementById('cancelModal').classList.remove('flex');
            document.getElementById('cancelCode').value = '';
            document.getElementById('cancelError').classList.add('hidden');
            currentBookingToCancel = null;
        }

        // Confirm cancel
        async function confirmCancel() {
            const cancelCode = document.getElementById('cancelCode').value;
            const errorElement = document.getElementById('cancelError');
            
            if (cancelCode !== '1234') {
                errorElement.classList.remove('hidden');
                return;
            }
            
            errorElement.classList.add('hidden');
            
            if (currentBookingToCancel) {
                const bookingIndex = bookings.findIndex(b => b.id == currentBookingToCancel);
                if (bookingIndex > -1) {
                    bookings[bookingIndex].status = 'cancelled';
                    
                    // Try to update online database
                    if (isOnlineMode) {
                        await updateOnlineDatabase(currentBookingToCancel, { status: 'cancelled' });
                    }
                    
                    // Always save to localStorage as backup
                    saveToLocalStorage();
                    
                    updateAllViews();
                    
                    alert('‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
            }
            closeCancelModal();
        }

        // Update statistics
        function updateStatistics() {
            const confirmedBookings = bookings.filter(b => b.status === 'confirmed');
            
            // Total bookings
            document.getElementById('totalBookings').textContent = confirmedBookings.length;
            
            // Most used room
            const roomUsage = {};
            confirmedBookings.forEach(booking => {
                roomUsage[booking.roomId] = (roomUsage[booking.roomId] || 0) + 1;
            });
            
            let mostUsedRoom = '';
            let maxUsage = 0;
            Object.entries(roomUsage).forEach(([roomId, count]) => {
                if (count > maxUsage) {
                    maxUsage = count;
                    mostUsedRoom = rooms.find(r => r.id === roomId)?.name || roomId;
                }
            });
            
            document.getElementById('mostUsedRoom').textContent = mostUsedRoom || '-';
            document.getElementById('mostUsedRoomCount').textContent = `${maxUsage} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
            
            // Peak time
            const timeUsage = {};
            confirmedBookings.forEach(booking => {
                const timeSlot = booking.startTime;
                timeUsage[timeSlot] = (timeUsage[timeSlot] || 0) + 1;
            });
            
            let peakTime = '';
            let maxTimeUsage = 0;
            Object.entries(timeUsage).forEach(([time, count]) => {
                if (count > maxTimeUsage) {
                    maxTimeUsage = count;
                    peakTime = time;
                }
            });
            
            document.getElementById('peakTime').textContent = peakTime || '-';
            document.getElementById('peakTimeCount').textContent = `${maxTimeUsage} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
            
            // Room statistics
            const roomStats = document.getElementById('roomStats');
            roomStats.innerHTML = rooms.slice(0, 10).map(room => {
                const usage = roomUsage[room.id] || 0;
                const percentage = confirmedBookings.length > 0 ? (usage / confirmedBookings.length * 100).toFixed(1) : 0;
                
                return `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="font-medium">${room.name}</span>
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">${usage} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (${percentage}%)</span>
                            <div class="w-20 bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-blue-500 to-pink-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Get room category for color coding
        function getRoomCategory(roomName) {
            if (roomName.includes('‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£') || roomName.includes('Mac') || roomName.includes('‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå')) {
                return 'lab';
            } else if (roomName.includes('‡∏õ.‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï') || roomName.includes('‡∏õ.‡πÇ‡∏ó') || roomName.includes('‡∏õ.‡πÄ‡∏≠‡∏Å')) {
                return 'graduate';
            } else if (roomName.includes('‡∏Ñ‡∏£‡∏±‡∏ß') || roomName.includes('‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô') || roomName.includes('‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°') || 
                      roomName.includes('‡∏û‡∏£‡∏°‡πÅ‡∏î‡∏á') || roomName.includes('‡∏Ñ‡∏≠‡∏™‡∏ï‡∏π‡∏°') || roomName.includes('‡πÄ‡∏ß‡∏ó‡∏µ‡∏î‡∏≥') || 
                      roomName.includes('‡∏™‡∏ï‡∏π‡∏î‡∏¥‡πÇ‡∏≠') || roomName.includes('‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á') || roomName.includes('Broadway')) {
                return 'special';
            } else {
                return 'lecture';
            }
        }

        // Get color class based on room category
        function getRoomColorClass(category) {
            switch (category) {
                case 'lab': return 'bg-blue-100 text-blue-800 border-blue-300';
                case 'graduate': return 'bg-pink-100 text-pink-800 border-pink-300';
                case 'special': return 'bg-purple-100 text-purple-800 border-purple-300';
                default: return 'bg-green-100 text-green-800 border-green-300';
            }
        }

        // Update week summary
        function updateWeekSummary() {
            const weekSummary = document.getElementById('weekSummary');
            const selectedRoomFilter = document.getElementById('scheduleRoomFilter').value;
            
            weekSummary.innerHTML = daysOfWeek.map(day => {
                const dayBookings = bookings.filter(booking => 
                    booking.day === day.id && 
                    booking.status === 'confirmed' &&
                    (!selectedRoomFilter || booking.roomId === selectedRoomFilter)
                );
                
                return `
                    <div class="p-2 bg-white rounded border">
                        <div class="font-medium text-sm text-gray-800">${day.shortName}</div>
                        <div class="text-lg font-bold ${dayBookings.length > 0 ? 'text-blue-600' : 'text-gray-400'}">
                            ${dayBookings.length}
                        </div>
                        <div class="text-xs text-gray-500">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    </div>
                `;
            }).join('');
        }

        // Update schedule view
        function updateScheduleView() {
            const selectedRoomFilter = document.getElementById('scheduleRoomFilter').value;
            const viewMode = document.getElementById('viewMode').value;
            const scheduleContainer = document.getElementById('scheduleContainer');
            
            // Update week summary
            updateWeekSummary();
            
            // Generate time slots for university schedule
            const timeSlots3Credit = [
                { time: '09:00-11:30', label: '09.00-11.30', credits: '3 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï (150 ‡∏ô‡∏≤‡∏ó‡∏µ)', start: '09:00', end: '11:30' },
                { time: '12:00-14:30', label: '12.00-14.30', credits: '3 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï (150 ‡∏ô‡∏≤‡∏ó‡∏µ)', start: '12:00', end: '14:30' },
                { time: '15:00-17:30', label: '15.00-17.30', credits: '3 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï (150 ‡∏ô‡∏≤‡∏ó‡∏µ)', start: '15:00', end: '17:30' },
                { time: '18:00-20:30', label: '18.00-20.30', credits: '3 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï (150 ‡∏ô‡∏≤‡∏ó‡∏µ)', start: '18:00', end: '20:30' }
            ];
            
            const timeSlots2Credit = [
                { time: '09:00-10:40', label: '09.00-10.40', credits: '2 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï', start: '09:00', end: '10:40' },
                { time: '11:00-12:40', label: '11.00-12.40', credits: '2 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï', start: '11:00', end: '12:40' },
                { time: '13:00-14:40', label: '13.00-14.40', credits: '2 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï', start: '13:00', end: '14:40' },
                { time: '15:00-16:40', label: '15.00-16.40', credits: '2 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï', start: '15:00', end: '16:40' },
                { time: '17:00-18:40', label: '17.00-18.40', credits: '2 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï', start: '17:00', end: '18:40' },
                { time: '19:00-20:40', label: '19.00-20.40', credits: '2 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï', start: '19:00', end: '20:40' }
            ];
            
            if (viewMode === 'day-horizontal') {
                // Days horizontal, Time vertical - Combined table
                const allTimeSlots = [...timeSlots3Credit, ...timeSlots2Credit];
                
                scheduleContainer.innerHTML = `
                    <div>
                        <h4 class="text-lg font-semibold text-gray-800 mb-3 bg-gradient-to-r from-blue-50 to-green-50 p-2 rounded">üìö ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                        <table class="w-full border-collapse border border-gray-300">
                            <thead>
                                <tr class="bg-gradient-to-r from-blue-500 to-pink-500 text-white">
                                    <th class="border border-gray-300 p-3 sticky left-0 bg-blue-500">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                    ${daysOfWeek.map(day => `
                                        <th class="border border-gray-300 p-3 min-w-32">${day.name}</th>
                                    `).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${allTimeSlots.map((timeSlot, index) => {
                                    const isFirstTwoCreditSlot = index === timeSlots3Credit.length;
                                    const rowClass = index < timeSlots3Credit.length ? 'bg-blue-25' : 'bg-green-25';
                                    
                                    return `
                                        ${isFirstTwoCreditSlot ? `
                                            <tr class="bg-green-100">
                                                <td colspan="${daysOfWeek.length + 1}" class="border border-gray-300 p-2 text-center font-semibold text-green-800">
                                                    üìñ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 2 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï
                                                </td>
                                            </tr>
                                        ` : ''}
                                        <tr class="${rowClass}">
                                            <td class="border border-gray-300 p-2 font-medium bg-gray-50 sticky left-0">
                                                <div class="text-sm font-semibold">${timeSlot.label}</div>
                                                <div class="text-xs text-gray-600">${timeSlot.credits}</div>
                                            </td>
                                            ${daysOfWeek.map(day => {
                                                const dayBookings = bookings.filter(booking => 
                                                    booking.day === day.id && 
                                                    booking.status === 'confirmed' &&
                                                    ((booking.startTime >= timeSlot.start && booking.startTime < timeSlot.end) ||
                                                     (booking.endTime > timeSlot.start && booking.endTime <= timeSlot.end) ||
                                                     (booking.startTime <= timeSlot.start && booking.endTime >= timeSlot.end)) &&
                                                    (!selectedRoomFilter || booking.roomId === selectedRoomFilter)
                                                );
                                                
                                                return `
                                                    <td class="border border-gray-300 p-1 min-h-16 align-top">
                                                        ${dayBookings.map(booking => {
                                                            const category = getRoomCategory(booking.roomName);
                                                            const colorClass = getRoomColorClass(category);
                                                            return `
                                                                <div class="text-xs ${colorClass} p-1 rounded mb-1 border cursor-pointer hover:shadow-sm transition-shadow" 
                                                                     title="‡∏´‡πâ‡∏≠‡∏á: ${booking.roomName}&#10;‡πÄ‡∏ß‡∏•‡∏≤: ${booking.startTime}-${booking.endTime}&#10;‡∏ß‡∏¥‡∏ä‡∏≤: ${booking.subject}">
                                                                    <div class="font-medium truncate">${booking.roomName}</div>
                                                                    <div class="truncate">${booking.subject}</div>
                                                                    <div class="text-xs opacity-75">${booking.startTime}-${booking.endTime}</div>
                                                                </div>
                                                            `;
                                                        }).join('')}
                                                    </td>
                                                `;
                                            }).join('')}
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                // Time horizontal, Days vertical - Combined table
                
                scheduleContainer.innerHTML = `
                    <div>
                        <h4 class="text-lg font-semibold text-gray-800 mb-3 bg-gradient-to-r from-blue-50 to-green-50 p-2 rounded">üìö ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                        <table class="w-full border-collapse border border-gray-300">
                            <thead>
                                <tr class="bg-gradient-to-r from-blue-500 to-pink-500 text-white">
                                    <th class="border border-gray-300 p-3 sticky left-0 bg-blue-500">‡∏ß‡∏±‡∏ô</th>
                                    ${timeSlots3Credit.map(timeSlot => `
                                        <th class="border border-gray-300 p-2 min-w-32 text-sm">
                                            <div class="font-semibold">${timeSlot.label}</div>
                                            <div class="text-xs opacity-90">${timeSlot.credits}</div>
                                        </th>
                                    `).join('')}
                                </tr>
                                <tr class="bg-gradient-to-r from-green-500 to-teal-500 text-white">
                                    <th class="border border-gray-300 p-3 sticky left-0 bg-green-500">‡∏ß‡∏±‡∏ô</th>
                                    ${timeSlots2Credit.map(timeSlot => `
                                        <th class="border border-gray-300 p-2 min-w-28 text-sm">
                                            <div class="font-semibold">${timeSlot.label}</div>
                                            <div class="text-xs opacity-90">${timeSlot.credits}</div>
                                        </th>
                                    `).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${daysOfWeek.map(day => `
                                    <tr>
                                        <td class="border border-gray-300 p-3 font-medium bg-gray-50 sticky left-0" rowspan="2">${day.name}</td>
                                        ${timeSlots3Credit.map(timeSlot => {
                                            const timeBookings = bookings.filter(booking => 
                                                booking.day === day.id && 
                                                booking.status === 'confirmed' &&
                                                ((booking.startTime >= timeSlot.start && booking.startTime < timeSlot.end) ||
                                                 (booking.endTime > timeSlot.start && booking.endTime <= timeSlot.end) ||
                                                 (booking.startTime <= timeSlot.start && booking.endTime >= timeSlot.end)) &&
                                                (!selectedRoomFilter || booking.roomId === selectedRoomFilter)
                                            );
                                            
                                            return `
                                                <td class="border border-gray-300 p-1 min-h-16 align-top">
                                                    ${timeBookings.map(booking => {
                                                        const category = getRoomCategory(booking.roomName);
                                                        const colorClass = getRoomColorClass(category);
                                                        return `
                                                            <div class="text-xs ${colorClass} p-1 rounded mb-1 border cursor-pointer hover:shadow-sm transition-shadow" 
                                                                 title="‡∏´‡πâ‡∏≠‡∏á: ${booking.roomName}&#10;‡πÄ‡∏ß‡∏•‡∏≤: ${booking.startTime}-${booking.endTime}&#10;‡∏ß‡∏¥‡∏ä‡∏≤: ${booking.subject}">
                                                                <div class="font-medium truncate">${booking.roomName.split(' ')[0]}</div>
                                                                <div class="truncate">${booking.subject}</div>
                                                            </div>
                                                        `;
                                                    }).join('')}
                                                </td>
                                            `;
                                        }).join('')}
                                    </tr>
                                    <tr>
                                        ${timeSlots2Credit.map(timeSlot => {
                                            const timeBookings = bookings.filter(booking => 
                                                booking.day === day.id && 
                                                booking.status === 'confirmed' &&
                                                ((booking.startTime >= timeSlot.start && booking.startTime < timeSlot.end) ||
                                                 (booking.endTime > timeSlot.start && booking.endTime <= timeSlot.end) ||
                                                 (booking.startTime <= timeSlot.start && booking.endTime >= timeSlot.end)) &&
                                                (!selectedRoomFilter || booking.roomId === selectedRoomFilter)
                                            );
                                            
                                            return `
                                                <td class="border border-gray-300 p-1 min-h-16 align-top bg-green-25">
                                                    ${timeBookings.map(booking => {
                                                        const category = getRoomCategory(booking.roomName);
                                                        const colorClass = getRoomColorClass(category);
                                                        return `
                                                            <div class="text-xs ${colorClass} p-1 rounded mb-1 border cursor-pointer hover:shadow-sm transition-shadow" 
                                                                 title="‡∏´‡πâ‡∏≠‡∏á: ${booking.roomName}&#10;‡πÄ‡∏ß‡∏•‡∏≤: ${booking.startTime}-${booking.endTime}&#10;‡∏ß‡∏¥‡∏ä‡∏≤: ${booking.subject}">
                                                                <div class="font-medium truncate">${booking.roomName.split(' ')[0]}</div>
                                                                <div class="truncate">${booking.subject}</div>
                                                            </div>
                                                        `;
                                                    }).join('')}
                                                </td>
                                            `;
                                        }).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
        }

        // Event listeners
        document.getElementById('startTime').addEventListener('change', updateRoomStatus);
        document.getElementById('endTime').addEventListener('change', updateRoomStatus);

        // Initialize the application when the page loads
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98442e0b277645be',t:'MTc1ODczNjgxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
