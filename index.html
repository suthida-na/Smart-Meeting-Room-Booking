<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Meeting Room Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #e0f2fe 0%, #f1f8e9 100%); }
        .card-shadow { box-shadow: 0 4px 20px rgba(0, 150, 136, 0.1); }
        .btn-primary { background: linear-gradient(135deg, #00bcd4 0%, #26a69a 100%); }
        .btn-primary:hover { background: linear-gradient(135deg, #00acc1 0%, #00897b 100%); }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-cyan-500 to-teal-500 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">üìÖ</span>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h1>
                </div>
                <div class="flex space-x-4">
                    <button onclick="showPage('home')" class="px-4 py-2 text-teal-600 hover:bg-teal-50 rounded-lg transition-colors">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                    <button onclick="showPage('myBookings')" class="px-4 py-2 text-teal-600 hover:bg-teal-50 rounded-lg transition-colors">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
                    <button onclick="showPage('calendar')" class="px-4 py-2 text-teal-600 hover:bg-teal-50 rounded-lg transition-colors">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
                    <button onclick="showPage('statistics')" class="px-4 py-2 text-teal-600 hover:bg-teal-50 rounded-lg transition-colors">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Home Page -->
        <div id="homePage" class="page">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">Smart Meeting Room Booking</h2>
                <p class="text-lg text-gray-600">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢ ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</p>
                <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-sm text-blue-800">
                        üí° <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        <br>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà: <a href="https://docs.google.com/spreadsheets/d/1IxtGbwoKh7bXDuiEPQ4MH6BDzZtWHcYY4pHgBB9Bki0/edit?gid=0#gid=0" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">Google Sheets</a>
                    </p>
                </div>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Date Selection -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 15 ‡∏ß‡∏±‡∏ô)
                    </h3>
                    <div id="datePickerCalendar" class="mb-4">
                        <!-- Calendar will be generated here -->
                    </div>
                    <div class="text-sm text-gray-600 mb-2">
                        ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: <span id="selectedDatesDisplay" class="font-medium text-teal-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
                    </div>
                    <button onclick="clearSelectedDates()" class="px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition-colors">‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
                </div>

                <!-- Time Selection -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        ‚è∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                            <select id="startTime" class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none" onchange="updateEndTimeOptions()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                            <select id="endTime" class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none" onchange="updateRoomStatus()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Room List -->
            <div class="mt-8">
                <h3 class="text-2xl font-semibold text-gray-800 mb-6 text-center">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h3>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="roomList">
                    <!-- Rooms will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- My Bookings Page -->
        <div id="myBookingsPage" class="page hidden">
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                
                <!-- Filters -->
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</label>
                        <select id="roomFilter" class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none" onchange="filterBookings()">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="dateFilter" class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none" onchange="filterBookings()">
                    </div>
                    <div class="flex items-end">
                        <button onclick="clearFilters()" class="w-full px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
                    </div>
                </div>

                <div id="myBookingsList">
                    <!-- Bookings will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Calendar Page -->
        <div id="calendarPage" class="page hidden">
            <div class="bg-white rounded-xl p-6 card-shadow">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h2>
                    <div class="flex items-center space-x-4">
                        <button onclick="changeMonth(-1)" class="px-3 py-1 bg-teal-500 text-white rounded hover:bg-teal-600 transition-colors">‚óÄ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô</button>
                        <span id="currentMonthYear" class="text-lg font-semibold text-gray-700"></span>
                        <button onclick="changeMonth(1)" class="px-3 py-1 bg-teal-500 text-white rounded hover:bg-teal-600 transition-colors">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂</button>
                    </div>
                </div>
                
                <!-- Room Filter -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</label>
                    <select id="calendarRoomFilter" class="w-full md:w-64 p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none" onchange="updateCalendarView()">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
                    </select>
                </div>
                
                <div id="monthlyCalendarView">
                    <!-- Monthly calendar will be populated by JavaScript -->
                </div>
                
                <!-- Room-wise booking list -->
                <div class="mt-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</h3>
                    <div id="roomWiseBookings">
                        <!-- Room-wise bookings will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Page -->
        <div id="statisticsPage" class="page hidden">
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                <div class="grid md:grid-cols-3 gap-6" id="statisticsContent">
                    <!-- Statistics will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-6">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h3>
            <form id="bookingForm" onsubmit="submitBooking(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</label>
                        <input type="text" id="modalRoomName" class="w-full p-3 border-2 border-gray-200 rounded-lg bg-gray-100" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="modalDate" class="w-full p-3 border-2 border-gray-200 rounded-lg bg-gray-100" readonly>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                            <input type="text" id="modalStartTime" class="w-full p-3 border-2 border-gray-200 rounded-lg bg-gray-100" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                            <input type="text" id="modalEndTime" class="w-full p-3 border-2 border-gray-200 rounded-lg bg-gray-100" readonly>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á *</label>
                        <input type="text" id="bookerName" class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
                        <input type="tel" id="bookerPhone" class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô *</label>
                        <textarea id="purpose" class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none h-24" required></textarea>
                    </div>
                </div>
                <div class="flex space-x-4 mt-6">
                    <button type="button" onclick="closeBookingModal()" class="flex-1 px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="flex-1 px-4 py-3 btn-primary text-white rounded-lg hover:shadow-lg transition-all">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cancel Booking Modal -->
    <div id="cancelModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h3>
            <p class="text-gray-600 mb-4">‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</p>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</label>
                <input type="text" id="cancelCode" class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 1234">
            </div>
            <div class="flex space-x-4">
                <button onclick="closeCancelModal()" class="flex-1 px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">‡∏õ‡∏¥‡∏î</button>
                <button onclick="confirmCancel()" class="flex-1 px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let rooms = [
            { id: 1, name: '‡∏´‡πâ‡∏≠‡∏áUSR(1-101)', capacity: 70, location: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 1 ‡∏ä‡∏±‡πâ‡∏ô 1' },
            { id: 2, name: '‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏±‡∏°‡∏°‡∏ô‡∏≤', capacity: 80, location: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 3 ‡∏ä‡∏±‡πâ‡∏ô 1' },
            { id: 3, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏û‡∏∏‡∏Ñ‡∏¢‡∏≤‡∏†‡∏£‡∏ì‡πå 1', capacity: 360, location: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 3 ‡∏ä‡∏±‡πâ‡∏ô 1' },
            { id: 4, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏û‡∏∏‡∏Ñ‡∏¢‡∏≤‡∏†‡∏£‡∏ì‡πå 2 (3-206)', capacity: 120, location: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 3 ‡∏ä‡∏±‡πâ‡∏ô 2' },
            { id: 5, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ 3-202', capacity: 40, location: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 3 ‡∏ä‡∏±‡πâ‡∏ô 2' }
        ];

        let bookings = [];
        let currentBookingId = null;
        let selectedDates = [];
        let currentCalendarDate = new Date();
        let currentViewDate = new Date();

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        function initializePage() {
            // Generate time options
            generateTimeOptions();
            
            // Populate room filters
            populateRoomFilters();
            
            // Generate date picker calendar
            generateDatePickerCalendar();
            
            // Initial room status update
            updateRoomStatus();
            
            // Show statistics
            updateStatistics();
        }

        function generateTimeOptions() {
            const startSelect = document.getElementById('startTime');
            const times = [];
            
            // Generate times from 09:00 to 20:30 with 30-minute intervals
            for (let hour = 9; hour <= 20; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    if (hour === 20 && minute > 30) break;
                    const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    times.push(timeStr);
                }
            }
            
            times.forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = time;
                startSelect.appendChild(option);
            });
        }

        function updateEndTimeOptions() {
            const startTime = document.getElementById('startTime').value;
            const endSelect = document.getElementById('endTime');
            
            endSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</option>';
            
            if (!startTime) return;
            
            const [startHour, startMinute] = startTime.split(':').map(Number);
            const startTotalMinutes = startHour * 60 + startMinute;
            
            // Generate end time options (minimum 30 minutes after start time)
            for (let hour = 9; hour <= 20; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    if (hour === 20 && minute > 30) break;
                    
                    const totalMinutes = hour * 60 + minute;
                    if (totalMinutes > startTotalMinutes) {
                        const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                        const option = document.createElement('option');
                        option.value = timeStr;
                        option.textContent = timeStr;
                        endSelect.appendChild(option);
                    }
                }
            }
            
            updateRoomStatus();
        }

        function generateDatePickerCalendar() {
            const calendar = document.getElementById('datePickerCalendar');
            const today = new Date();
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Month names in Thai
            const monthNames = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];
            
            // Day names in Thai
            const dayNames = ['‡∏≠‡∏≤', '‡∏à', '‡∏≠', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™'];
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            let calendarHTML = `
                <div class="flex justify-between items-center mb-4">
                    <button onclick="changeCalendarMonth(-1)" class="px-2 py-1 bg-teal-500 text-white rounded hover:bg-teal-600 transition-colors">‚óÄ</button>
                    <h4 class="text-lg font-semibold text-gray-800">${monthNames[month]} ${year + 543}</h4>
                    <button onclick="changeCalendarMonth(1)" class="px-2 py-1 bg-teal-500 text-white rounded hover:bg-teal-600 transition-colors">‚ñ∂</button>
                </div>
                <div class="grid grid-cols-7 gap-1 mb-2">
            `;
            
            // Add day headers
            dayNames.forEach(day => {
                calendarHTML += `<div class="text-center text-sm font-medium text-gray-600 p-2">${day}</div>`;
            });
            
            calendarHTML += '</div><div class="grid grid-cols-7 gap-1">';
            
            // Add calendar days
            const currentDate = new Date(startDate);
            for (let i = 0; i < 42; i++) {
                const dateStr = currentDate.toISOString().split('T')[0];
                const isCurrentMonth = currentDate.getMonth() === month;
                const isPast = currentDate < today;
                const isSelected = selectedDates.includes(dateStr);
                
                let dayClass = 'p-2 text-center text-sm cursor-pointer rounded transition-colors ';
                
                if (!isCurrentMonth) {
                    dayClass += 'text-gray-300 ';
                } else if (isPast) {
                    dayClass += 'text-gray-400 cursor-not-allowed ';
                } else if (isSelected) {
                    dayClass += 'bg-teal-500 text-white ';
                } else {
                    dayClass += 'text-gray-700 hover:bg-teal-100 ';
                }
                
                const clickHandler = (!isPast && isCurrentMonth) ? `onclick="toggleDateSelection('${dateStr}')"` : '';
                
                calendarHTML += `<div class="${dayClass}" ${clickHandler}>${currentDate.getDate()}</div>`;
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            calendarHTML += '</div>';
            calendar.innerHTML = calendarHTML;
            
            updateSelectedDatesDisplay();
        }
        
        function changeCalendarMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            generateDatePickerCalendar();
        }
        
        function toggleDateSelection(dateStr) {
            const index = selectedDates.indexOf(dateStr);
            
            if (index > -1) {
                selectedDates.splice(index, 1);
            } else {
                if (selectedDates.length >= 15) {
                    alert('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 15 ‡∏ß‡∏±‡∏ô');
                    return;
                }
                selectedDates.push(dateStr);
            }
            
            selectedDates.sort();
            generateDatePickerCalendar();
            updateRoomStatus();
        }
        
        function clearSelectedDates() {
            selectedDates = [];
            generateDatePickerCalendar();
            updateRoomStatus();
        }
        
        function updateSelectedDatesDisplay() {
            const display = document.getElementById('selectedDatesDisplay');
            if (selectedDates.length === 0) {
                display.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
            } else {
                display.textContent = `${selectedDates.length} ‡∏ß‡∏±‡∏ô (${selectedDates[0]} ${selectedDates.length > 1 ? '- ' + selectedDates[selectedDates.length - 1] : ''})`;
            }
        }

        function updateRoomStatus() {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            const roomList = document.getElementById('roomList');
            roomList.innerHTML = '';
            
            rooms.forEach(room => {
                let isAnyDateBooked = false;
                
                // Check if any selected date has booking conflicts
                if (selectedDates.length > 0) {
                    isAnyDateBooked = selectedDates.some(date => 
                        checkRoomAvailability(room.id, date, startTime, endTime)
                    );
                }
                
                const statusClass = isAnyDateBooked ? 'bg-red-50 border-red-200' : 'bg-green-50 border-green-200';
                const statusIcon = isAnyDateBooked ? '‚ùå' : '‚úÖ';
                const statusText = isAnyDateBooked ? '‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß' : '‡∏ß‡πà‡∏≤‡∏á';
                const buttonDisabled = isAnyDateBooked || selectedDates.length === 0 || !startTime || !endTime;
                
                const roomCard = document.createElement('div');
                roomCard.className = `${statusClass} border-2 rounded-xl p-6 card-shadow transition-all hover:shadow-lg`;
                roomCard.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold text-gray-800">${room.name}</h4>
                        <span class="text-2xl">${statusIcon}</span>
                    </div>
                    <div class="space-y-2 mb-4">
                        <p class="text-sm text-gray-600">üìç ${room.location}</p>
                        <p class="text-sm text-gray-600">üë• ‡∏à‡∏∏‡πÑ‡∏î‡πâ ${room.capacity} ‡∏Ñ‡∏ô</p>
                        <p class="text-sm font-medium ${isAnyDateBooked ? 'text-red-600' : 'text-green-600'}">${statusText}</p>
                        ${selectedDates.length > 0 ? `<p class="text-xs text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${selectedDates.length} ‡∏ß‡∏±‡∏ô</p>` : ''}
                    </div>
                    <button 
                        onclick="openBookingModal(${room.id})" 
                        class="w-full px-4 py-2 btn-primary text-white rounded-lg hover:shadow-lg transition-all ${buttonDisabled ? 'opacity-50 cursor-not-allowed' : ''}"
                        ${buttonDisabled ? 'disabled' : ''}
                    >
                        ${buttonDisabled ? (selectedDates.length === 0 ? '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô' : (isAnyDateBooked ? '‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô')) : '‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ'}
                    </button>
                `;
                roomList.appendChild(roomCard);
            });
        }

        function checkRoomAvailability(roomId, date, startTime, endTime) {
            if (!date || !startTime || !endTime) return false;
            
            return bookings.some(booking => 
                booking.roomId === roomId && 
                booking.date === date && 
                booking.status === 'confirmed' &&
                ((startTime >= booking.startTime && startTime < booking.endTime) ||
                 (endTime > booking.startTime && endTime <= booking.endTime) ||
                 (startTime <= booking.startTime && endTime >= booking.endTime))
            );
        }

        function openBookingModal(roomId) {
            const room = rooms.find(r => r.id === roomId);
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            document.getElementById('modalRoomName').value = room.name;
            document.getElementById('modalDate').value = selectedDates.join(', ');
            document.getElementById('modalStartTime').value = startTime;
            document.getElementById('modalEndTime').value = endTime;
            
            // Clear form
            document.getElementById('bookerName').value = '';
            document.getElementById('bookerPhone').value = '';
            document.getElementById('purpose').value = '';
            
            document.getElementById('bookingModal').classList.remove('hidden');
        }

        function closeBookingModal() {
            document.getElementById('bookingModal').classList.add('hidden');
        }

        async function submitBooking(event) {
            event.preventDefault();
            
            const roomName = document.getElementById('modalRoomName').value;
            const room = rooms.find(r => r.name === roomName);
            const startTime = document.getElementById('modalStartTime').value;
            const endTime = document.getElementById('modalEndTime').value;
            const bookerName = document.getElementById('bookerName').value;
            const bookerPhone = document.getElementById('bookerPhone').value;
            const purpose = document.getElementById('purpose').value;
            
            // Show loading state
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            submitBtn.disabled = true;
            
            try {
                // Create bookings for each selected date
                const newBookings = [];
                for (const date of selectedDates) {
                    const booking = {
                        id: Date.now() + Math.random(),
                        roomId: room.id,
                        roomName: room.name,
                        date: date,
                        startTime: startTime,
                        endTime: endTime,
                        bookerName: bookerName,
                        bookerPhone: bookerPhone,
                        purpose: purpose,
                        status: 'confirmed',
                        createdAt: new Date().toISOString()
                    };
                    
                    // Send each booking to Google Sheets
                    await saveToGoogleSheets(booking);
                    newBookings.push(booking);
                }
                
                bookings.push(...newBookings);
                closeBookingModal();
                
                // Clear selected dates after successful booking
                selectedDates = [];
                generateDatePickerCalendar();
                
                updateRoomStatus();
                updateMyBookings();
                updateStatistics();
                
                alert(`‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${newBookings.length} ‡∏ß‡∏±‡∏ô ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheets ‡πÅ‡∏•‡πâ‡∏ß`);
            } catch (error) {
                console.error('Error saving to Google Sheets:', error);
                
                // Still save locally even if Google Sheets fails
                const newBookings = [];
                for (const date of selectedDates) {
                    const booking = {
                        id: Date.now() + Math.random(),
                        roomId: room.id,
                        roomName: room.name,
                        date: date,
                        startTime: startTime,
                        endTime: endTime,
                        bookerName: bookerName,
                        bookerPhone: bookerPhone,
                        purpose: purpose,
                        status: 'confirmed',
                        createdAt: new Date().toISOString()
                    };
                    newBookings.push(booking);
                }
                
                bookings.push(...newBookings);
                closeBookingModal();
                
                // Clear selected dates after booking
                selectedDates = [];
                generateDatePickerCalendar();
                
                updateRoomStatus();
                updateMyBookings();
                updateStatistics();
                
                alert(`‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${newBookings.length} ‡∏ß‡∏±‡∏ô (‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheets ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ)`);
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        async function saveToGoogleSheets(booking) {
            // Google Apps Script Web App URL - ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Google Apps Script ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà URL ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx6exP-Dt9gQLsQZkOd56CZ-c5qOm6xzfC5smjsx6STM69Ek9MjSb9Phlw2Zpx8zxCc/exec';
            
            const data = {
                timestamp: new Date().toLocaleString('th-TH'),
                bookingId: booking.id,
                roomName: booking.roomName,
                date: booking.date,
                startTime: booking.startTime,
                endTime: booking.endTime,
                bookerName: booking.bookerName,
                bookerPhone: booking.bookerPhone,
                purpose: booking.purpose,
                status: booking.status
            };
            
            // For demo purposes, we'll simulate the API call
            // In real implementation, uncomment the fetch code below
            
            /*
            const response = await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            
            if (!response.ok) {
                throw new Error('Failed to save to Google Sheets');
            }
            
            return await response.json();
            */
            
            // Simulate successful save for demo
            return new Promise((resolve) => {
                setTimeout(() => {
                    console.log('Data that would be sent to Google Sheets:', data);
                    resolve({ success: true });
                }, 1000);
            });
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show selected page
            document.getElementById(pageId + 'Page').classList.remove('hidden');
            
            if (pageId === 'myBookings') {
                updateMyBookings();
            } else if (pageId === 'calendar') {
                updateCalendarView();
            } else if (pageId === 'statistics') {
                updateStatistics();
            }
        }

        function populateRoomFilters() {
            const roomFilter = document.getElementById('roomFilter');
            const calendarRoomFilter = document.getElementById('calendarRoomFilter');
            
            rooms.forEach(room => {
                // For my bookings filter
                const option = document.createElement('option');
                option.value = room.id;
                option.textContent = room.name;
                roomFilter.appendChild(option);
                
                // For calendar filter
                const calendarOption = document.createElement('option');
                calendarOption.value = room.id;
                calendarOption.textContent = room.name;
                calendarRoomFilter.appendChild(calendarOption);
            });
        }

        function updateMyBookings() {
            const bookingsList = document.getElementById('myBookingsList');
            const roomFilter = document.getElementById('roomFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            let filteredBookings = bookings.filter(booking => booking.status === 'confirmed');
            
            if (roomFilter) {
                filteredBookings = filteredBookings.filter(booking => booking.roomId == roomFilter);
            }
            
            if (dateFilter) {
                filteredBookings = filteredBookings.filter(booking => booking.date === dateFilter);
            }
            
            if (filteredBookings.length === 0) {
                bookingsList.innerHTML = '<p class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>';
                return;
            }
            
            bookingsList.innerHTML = filteredBookings.map(booking => `
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">${booking.roomName}</h4>
                            <p class="text-sm text-gray-600">üë§ ${booking.bookerName}</p>
                            <p class="text-sm text-gray-600">üìÖ ${booking.date}</p>
                            <p class="text-sm text-gray-600">‚è∞ ${booking.startTime} - ${booking.endTime}</p>
                            <p class="text-sm text-gray-600">üìù ${booking.purpose}</p>
                        </div>
                        <button 
                            onclick="openCancelModal(${booking.id})" 
                            class="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition-colors"
                        >
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterBookings() {
            updateMyBookings();
        }

        function clearFilters() {
            document.getElementById('roomFilter').value = '';
            document.getElementById('dateFilter').value = '';
            updateMyBookings();
        }

        function openCancelModal(bookingId) {
            currentBookingId = bookingId;
            document.getElementById('cancelCode').value = '';
            document.getElementById('cancelModal').classList.remove('hidden');
        }

        function closeCancelModal() {
            document.getElementById('cancelModal').classList.add('hidden');
            currentBookingId = null;
        }

        function confirmCancel() {
            const code = document.getElementById('cancelCode').value;
            if (code !== '1234') {
                alert('‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }
            
            const bookingIndex = bookings.findIndex(b => b.id === currentBookingId);
            if (bookingIndex !== -1) {
                bookings[bookingIndex].status = 'cancelled';
                closeCancelModal();
                updateMyBookings();
                updateRoomStatus();
                updateStatistics();
                alert('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }
        }

        function updateCalendarView() {
            updateMonthlyCalendarView();
            updateRoomWiseBookings();
        }
        
        function updateMonthlyCalendarView() {
            const calendarView = document.getElementById('monthlyCalendarView');
            const roomFilter = document.getElementById('calendarRoomFilter').value;
            let confirmedBookings = bookings.filter(b => b.status === 'confirmed');
            
            // Apply room filter
            if (roomFilter) {
                confirmedBookings = confirmedBookings.filter(b => b.roomId == roomFilter);
            }
            
            const year = currentViewDate.getFullYear();
            const month = currentViewDate.getMonth();
            
            // Month names in Thai
            const monthNames = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];
            
            // Day names in Thai
            const dayNames = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            
            // Update month/year display
            document.getElementById('currentMonthYear').textContent = `${monthNames[month]} ${year + 543}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            // Group bookings by date for this month
            const bookingsByDate = {};
            confirmedBookings.forEach(booking => {
                const bookingDate = new Date(booking.date);
                if (bookingDate.getMonth() === month && bookingDate.getFullYear() === year) {
                    const dateStr = booking.date;
                    if (!bookingsByDate[dateStr]) {
                        bookingsByDate[dateStr] = [];
                    }
                    bookingsByDate[dateStr].push(booking);
                }
            });
            
            // Room colors for visual distinction
            const roomColors = [
                'bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-red-500', 'bg-yellow-500',
                'bg-indigo-500', 'bg-pink-500', 'bg-teal-500', 'bg-orange-500', 'bg-cyan-500'
            ];
            
            let calendarHTML = `
                <div class="grid grid-cols-7 gap-1 mb-2">
            `;
            
            // Add day headers
            dayNames.forEach(day => {
                calendarHTML += `<div class="text-center text-sm font-medium text-gray-600 p-2 bg-gray-50 rounded">${day}</div>`;
            });
            
            calendarHTML += '</div><div class="grid grid-cols-7 gap-1">';
            
            // Add calendar days
            const currentDate = new Date(startDate);
            for (let i = 0; i < 42; i++) {
                const dateStr = currentDate.toISOString().split('T')[0];
                const isCurrentMonth = currentDate.getMonth() === month;
                const dayBookings = bookingsByDate[dateStr] || [];
                const hasBookings = dayBookings.length > 0;
                
                let dayClass = 'min-h-[100px] p-1 border border-gray-200 rounded ';
                
                if (!isCurrentMonth) {
                    dayClass += 'bg-gray-50 text-gray-300 ';
                } else if (hasBookings) {
                    dayClass += 'bg-blue-50 ';
                } else {
                    dayClass += 'bg-white ';
                }
                
                let dayContent = `
                    <div class="text-sm font-medium ${isCurrentMonth ? 'text-gray-800' : 'text-gray-400'} mb-1">
                        ${currentDate.getDate()}
                    </div>
                `;
                
                if (hasBookings && isCurrentMonth) {
                    // Group bookings by room for better display
                    const bookingsByRoom = {};
                    dayBookings.forEach(booking => {
                        if (!bookingsByRoom[booking.roomName]) {
                            bookingsByRoom[booking.roomName] = [];
                        }
                        bookingsByRoom[booking.roomName].push(booking);
                    });
                    
                    let roomIndex = 0;
                    Object.keys(bookingsByRoom).forEach(roomName => {
                        const roomBookings = bookingsByRoom[roomName];
                        const color = roomColors[roomIndex % roomColors.length];
                        
                        dayContent += `
                            <div class="text-xs ${color} text-white rounded px-1 py-0.5 mb-1 truncate" 
                                 title="${roomName}: ${roomBookings.length} ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á">
                                ${roomName.length > 8 ? roomName.substring(0, 8) + '...' : roomName} (${roomBookings.length})
                            </div>
                        `;
                        roomIndex++;
                    });
                    
                    if (Object.keys(bookingsByRoom).length > 3) {
                        dayContent += `<div class="text-xs text-blue-600">+${Object.keys(bookingsByRoom).length - 3} ‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô</div>`;
                    }
                }
                
                calendarHTML += `<div class="${dayClass}">${dayContent}</div>`;
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            calendarHTML += '</div>';
            calendarView.innerHTML = calendarHTML;
        }
        
        function updateRoomWiseBookings() {
            const roomWiseContainer = document.getElementById('roomWiseBookings');
            const roomFilter = document.getElementById('calendarRoomFilter').value;
            let confirmedBookings = bookings.filter(b => b.status === 'confirmed');
            
            const year = currentViewDate.getFullYear();
            const month = currentViewDate.getMonth();
            
            // Filter bookings for current month
            confirmedBookings = confirmedBookings.filter(booking => {
                const bookingDate = new Date(booking.date);
                return bookingDate.getMonth() === month && bookingDate.getFullYear() === year;
            });
            
            // Apply room filter
            if (roomFilter) {
                confirmedBookings = confirmedBookings.filter(b => b.roomId == roomFilter);
            }
            
            // Group bookings by room
            const bookingsByRoom = {};
            confirmedBookings.forEach(booking => {
                if (!bookingsByRoom[booking.roomName]) {
                    bookingsByRoom[booking.roomName] = [];
                }
                bookingsByRoom[booking.roomName].push(booking);
            });
            
            if (Object.keys(bookingsByRoom).length === 0) {
                roomWiseContainer.innerHTML = '<p class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>';
                return;
            }
            
            let roomWiseHTML = '';
            
            Object.keys(bookingsByRoom).forEach(roomName => {
                const roomBookings = bookingsByRoom[roomName].sort((a, b) => {
                    if (a.date === b.date) {
                        return a.startTime.localeCompare(b.startTime);
                    }
                    return a.date.localeCompare(b.date);
                });
                
                roomWiseHTML += `
                    <div class="mb-6 border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-teal-500 text-white px-4 py-3">
                            <h4 class="font-semibold text-lg">${roomName}</h4>
                            <p class="text-sm opacity-90">${roomBookings.length} ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>
                        </div>
                        <div class="p-4">
                            <div class="grid gap-3">
                `;
                
                roomBookings.forEach(booking => {
                    const bookingDate = new Date(booking.date);
                    const dayName = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'][bookingDate.getDay()];
                    
                    roomWiseHTML += `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <div class="flex-1">
                                <div class="flex items-center space-x-4">
                                    <div class="text-sm font-medium text-gray-800">
                                        üìÖ ${booking.date} (${dayName})
                                    </div>
                                    <div class="text-sm text-gray-600">
                                        ‚è∞ ${booking.startTime} - ${booking.endTime}
                                    </div>
                                </div>
                                <div class="mt-1 text-sm text-gray-600">
                                    üë§ ${booking.bookerName} | üìû ${booking.bookerPhone}
                                </div>
                                <div class="mt-1 text-sm text-gray-600">
                                    üìù ${booking.purpose}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                roomWiseHTML += `
                            </div>
                        </div>
                    </div>
                `;
            });
            
            roomWiseContainer.innerHTML = roomWiseHTML;
        }
        
        function changeMonth(direction) {
            currentViewDate.setMonth(currentViewDate.getMonth() + direction);
            updateMonthlyCalendarView();
        }

        function updateStatistics() {
            const statisticsContent = document.getElementById('statisticsContent');
            const confirmedBookings = bookings.filter(b => b.status === 'confirmed');
            
            // Total bookings
            const totalBookings = confirmedBookings.length;
            
            // Most popular room
            const roomUsage = {};
            confirmedBookings.forEach(booking => {
                roomUsage[booking.roomName] = (roomUsage[booking.roomName] || 0) + 1;
            });
            const mostPopularRoom = Object.keys(roomUsage).reduce((a, b) => 
                roomUsage[a] > roomUsage[b] ? a : b, '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            
            // Most popular time
            const timeUsage = {};
            confirmedBookings.forEach(booking => {
                const hour = booking.startTime.split(':')[0];
                timeUsage[hour] = (timeUsage[hour] || 0) + 1;
            });
            const mostPopularTime = Object.keys(timeUsage).reduce((a, b) => 
                timeUsage[a] > timeUsage[b] ? a : b, '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            
            statisticsContent.innerHTML = `
                <div class="bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-xl p-6 text-center">
                    <div class="text-3xl font-bold mb-2">${totalBookings}</div>
                    <div class="text-sm opacity-90">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="bg-gradient-to-r from-teal-500 to-green-500 text-white rounded-xl p-6 text-center">
                    <div class="text-lg font-bold mb-2">${mostPopularRoom}</div>
                    <div class="text-sm opacity-90">‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                </div>
                <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl p-6 text-center">
                    <div class="text-lg font-bold mb-2">${mostPopularTime !== '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' ? mostPopularTime + ':00' : mostPopularTime}</div>
                    <div class="text-sm opacity-90">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                </div>
            `;
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98423e9602404b58',t:'MTc1ODcxNjUxNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
